setup :
	echo "Configured for genbank release number [% conf.currentGBRelease %]"

[% conf.GB_TAXONOMY_DIR %]/[% conf.GB_TAXONOMY_ARC %] : 
	wget [% conf.GB_TAXONOMY_URL %] -O $@

[% conf.GB_TAXONOMY_DIR %]/names.dmp : [% conf.GB_TAXONOMY_DIR %]/[% conf.GB_TAXONOMY_ARC %]
	cd [% conf.GB_TAXONOMY_DIR %] && tar -zxvf [% conf.GB_TAXONOMY_ARC %] $(@F) && cd -

[% conf.GB_TAXONOMY_DIR %]/nodes.dmp : [% conf.GB_TAXONOMY_DIR %]/[% conf.GB_TAXONOMY_ARC %]
	cd [% conf.GB_TAXONOMY_DIR %] && tar -zxvf [% conf.GB_TAXONOMY_ARC %] $(@F) && cd -
	
taxonomy : [% conf.GB_TAXONOMY_DIR %]/names.dmp [% conf.GB_TAXONOMY_DIR %]/nodes.dmp

schema : [% conf.SCHEMA_FILE %]
	mysql -u [% conf.USER %] -p[% conf.PASS %] [% conf.DATABASE %] < $<

dao :
	perl -MDBIx::Class::Schema::Loader=make_schema_at,dump_to_dir:./lib \
		-e 'make_schema_at("Bio::Phylo::PhyLoTA::DAO", \
		{ db_schema => "phylota" }, \
		[ "dbi:[% conf.RDBMS %]:dbname=[% conf.DATABASE %]", "[% conf.USER %]", "[% conf.PASS %]" ])'

[% conf.DUMP_IN_FILE %] :
	curl [% conf.DUMP_IN_URL %][% conf.DUMP_IN_CHUNKS %] > $@

dldump : [% conf.DUMP_IN_FILE %]

load_dump : [% conf.DUMP_IN_FILE %]
	zcat $< | mysql -u [% conf.USER %] -p[% conf.PASS %] [% conf.DATABASE %]

[% conf.DUMP_OUT_FILE %].gz :
	mysqldump -u [% conf.USER %] -p[% conf.PASS %] [% conf.DATABASE %] | gzip -9 > $@

[% conf.SUPERSMART_COMMONTREE %] : [% conf.SUPERSMART_SPECIESLIST %]
	perl -Ilib script/supersmart/write_common_tree.pl --nodelabels -i $< [% conf.SUPERSMART_VERBOSITY %] > $@

commontree : [% conf.SUPERSMART_COMMONTREE %]

[% conf.SUPERSMART_ALIGNMENTLIST %] : [% conf.SUPERSMART_SPECIESLIST %]
	perl -Ilib script/supersmart/write_alignments.pl -i $< [% conf.SUPERSMART_VERBOSITY %] -s [% conf.SUPERSMART_ALIGNMENTSTEM %] > $@

alignments : [% conf.SUPERSMART_ALIGNMENTLIST %]